var app_url=window.location.origin,app_location=window.location;$(function(){toastr.options.timeOut=1500,toastr.options.extendedTimeOut=60,toastr.options.progressBar=!0,$('form#upload-url').submit(function(a){a.preventDefault(),$('#file_url').val().trim().length||exit();var b=$('#file_url').val().split('\n');$.each(b,function(){sharemulti(this)})}),$('form#upload-picker').submit(function(a){a.preventDefault();var b=$('.files');sharepicker(b)}),$('#btn-del').click(function(){swal({title:'Are you sure?',text:'You won\'t be able to revert this!',type:'warning',showCancelButton:!0,confirmButtonColor:'#d33',confirmButtonText:'Yes, delete it!'}).then(a=>{a.value&&$('input[name="file-item"]:checked').each(function(){var b=$(this).val();delFile(b,$(this).attr('data-index'),!0)})})}),$('#btn-mdl').bind('click',function(){$('input[name=file-item]').is(':checked')&&($('#frm-edit').html(''),$('#modalEdit').modal('show'),$('input[name=file-item]:checked').each(function(a){if(!(10<=a)){var b=$(this).attr('data-index'),c=$(this).val(),d=$('tr[data-index='+b+']').children('td:nth-child(2)').text();$('#frm-edit').append(`<input class="form-control fName" minlength="5" data-id="${c}" name="fName" value="${d}">`)}}))}),$('#btn-link').bind('click',function(){results=[];$('input[name=file-item]').is(':checked')&&($('#txtarea-links').html(''),$('#modalLink').modal('show'),$('input[name=file-item]:checked').each(function(){var b=$(this).attr('data-index'),c=$(this).val(),d=$('tr[data-index='+b+']'),g=d.find('a').attr('href');results.push(app_url+g)}),$('#txtarea-links').html(results.join('\r\n')))}),$('form#frm-edit').submit(function(a){a.preventDefault();var b=$(this).find('.fName');$.each(b,function(c,d){var g=$(d),j=g.attr('data-id'),l=g.val();$.post(app_url+'/action/update-filename',{fid:j,fname:l},function(m){m.success&&toastr.success(l,'Rename Succeeded')},'json')})}),$('select#protect-opt').change(function(){var b,a=$(this).find(':selected').val();$.post(app_url+'/system/update-usersettings.php',{protect:a},function(c){c.success&&(b=1==a?'Feature was <i>Enabled</i>':'Feature was <i>Disabled</i>',toastr.info(b,'Protect my Files'))},'json')})});function dl(a){a.innerHTML=a.text+'<i class="fa fa-circle-o-notch fa-spin fa-1x fa-fw">',window.location.href=dlUrl}function copier(a){a.select();var b=document.execCommand('copy');b&&alert('Copy to clipboard')}function delFile(a,b=null,c=!1){$.ajax({url:app_url+'/action/delete',type:'GET',cache:!0,data:{file_id:a},dataType:'json',success:function(d){return d.success?c?$('tr[data-index='+b+']').fadeOut(500).remove():swal('Delete File','File was successfully deleted','success'):swal('Delete File',d.msg,'error')}})}function sharemulti(a){results=[],$.ajax({url:app_url+'/action/share',type:'POST',cache:!0,data:{file_url:a},dataType:'json',beforeSend:function(){$('#shareFrm1').hide(),$('#btn-share').prop('disabled',!0),$('.preload1').show(),$('#sharetext').empty()},success:function(b){if(b.success){var c=app_url+'/'+b.share[0].file_url;results.push(c.link(c)),toastr.success(b.share[0].file_name,'Success'),$('#shareFrm1').show(400),$('#sharetext').html(results.join('<br/>'))}else b.protect?toastr.error(b.msg,'Protected by Owner'):toastr.error(b.msg,'Error')},complete:function(){$('.preload1').hide(),setTimeout(function(){$('#btn-share').prop('disabled',!1)},5e3)},error:function(b){console.log(b),swal('Failed','Oow.. error when receiving request, make sure input URL correctly','error')}})}function sharepicker(a){return results=[],1>a.length?swal('Please choose a file to continue'):void($('#btn-share').prop('disabled',!0),$.each(a,function(b,c){var d=$(c),g=d.attr('g-id');d.find('.statFile').html(`<small class="badge-pill badge-secondary">uploading..</small>`),$.ajax({url:app_url+'/action/share-picker',type:'POST',cache:!0,data:{data_file:g},success:function(j){if(j.success){var l=j.share[0],m=app_url+'/'+l.file_url;results.push(m),d.find('.nameFile').attr(`href`,'/'+l.file_url),d.find('.statFile').html(`<small class="badge-pill badge-success"><i class="fa fa-check"></i></small>`)}else d.find('.statFile').html(`<small class="badge-pill badge-danger">error</small>`)},complete:function(){$('#shareFrm2').show(400),$('#sharetext').html(results.join('<br/>')),setTimeout(function(){$('#btn-share').prop('disabled',!1)},5e3)},error:function(j){console.log(j.status)}})}))}