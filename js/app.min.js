var app_url=window.location.origin,app_location=window.location;$(function(){toastr.options.timeOut=1500,toastr.options.extendedTimeOut=60,toastr.options.progressBar=!0,$("form#upload-url").submit(function(a){if(a.preventDefault(),!!$("#file_url").val().trim().length){var b=$("#file_url").val().split("\n");$("#shareFrm1").hide(),$("#sharetext, #sharehtmlcode, #sharebbcode").empty(),UploadLinks(b)}}),$("form#upload-picker").submit(function(a){a.preventDefault();var b=$(".files");UploadPicker(b)}),$("#btn-del").click(function(){swal({title:"Are you sure?",text:"You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(a=>{a.value&&$("input[name=\"file-item\"]:checked").each(function(){delFile($(this))})})}),$("#btn-mdl").bind("click",function(){$("input[name=file-item]").is(":checked")&&($("#frm-edit").html(""),$("#modalEdit").modal("show"),$("input[name=file-item]:checked").each(function(a){if(!(20<=a)){var b=$(this),c=b.val(),d=b.parent().parent("tr").find("td:nth-child(2)").text();$("#frm-edit").append(`<input class="form-control fName" minlength="5" data-id="${c}" name="fName" value="${d}">`)}}))}),$("#btn-link").bind("click",function(){results=[];$("input[name=file-item]").is(":checked")&&($("#txtarea-links").html(""),$("#modalLink").modal("show"),$("input[name=file-item]:checked").each(function(){var a=$(this).parent().parent("tr").find("a").attr("href");results.push(app_url+a)}),$("#txtarea-links").html(results.join("\r\n")))}),$("form#frm-edit").submit(function(a){a.preventDefault();var b=$(this).find(".fName");$.each(b,function(a,b){var c=$(b),d=c.attr("data-id"),e=c.val();$.post(app_url+"/ajax/update-filename",{fid:d,fname:e},function(a){a.success&&toastr.success(e,"Rename Succeeded")},"json")})}),$("select#protect-opt").change(function(){var a,b=$(this).find(":selected").val();$.post(app_url+"/ajax/update-protect",{protect:b},function(c){c.success&&(a=1==b?"Feature was <i>Enabled</i>":"Feature was <i>Disabled</i>",toastr.info(a,"Protect my Files"))},"json")}),$("form#iProfile").submit(function(a){a.preventDefault(),$.post(app_url+"/ajax/update-vProfile",$(this).serialize(),function(a){console.log(a),a.success&&toastr.success("Profile updated successfully")},"json")}),$(".search > input[type=text]").change(function(){$("#myfile").bootstrapTable("refresh")})});function dl(a){a.innerHTML="<i class=\"fa fa-circle-o-notch fa-spin fa-1x fa-fw\"></i>Downloading",window.location.href=dlUrl}function copier(a){a.select();var b=document.execCommand("copy");b&&alert("Copy to clipboard")}function delFile(a,b=!1,c=!1,d=!1){id=c?a:a.val();let e={file_id:id};if(c&&d){var f=confirm("The file is Copyright?")?prompt("DMCA Report by"):null;e.dmca=f}$.post(app_url+"/ajax/delete",{file_id:id,dmca:f},function(d){if(d.success){if(c)return swal("Delete File","File was successfully deleted","success");a.parent().parent("tr").fadeOut("fast",function(){$(this).remove()}),b&&toastr.success("Success deleted","Delete File")}else{if(c)return swal("Delete File",d.msg,"error");toastr.error("Error deleted","Delete File")}},"json")}function UploadLinks(a,b){b||(b=0);var c=a[b];c&&$.ajax({url:app_url+"/ajax/copy-drive",type:"POST",cache:!0,data:{file_url:c},dataType:"json",beforeSend:function(){$("#btn-share").prop("disabled",!0),$(".preload1").show()},success:function(a){if(a.success){var b=app_url+"/"+a.share[0].file_url,c=a.share[0].file_name,d=htmlEntities(`<a href="${b}">${c}</a>`),e=htmlEntities(`[URL=${b}]${c}[/URL]`);toastr.success(c,"Success"),$("#shareFrm1").show(400),$("#sharetext").append(b.link(b)+"<br/>"),$("#sharehtmlcode").append(d+"<br/>"),$("#sharebbcode").append(e+"<br/>")}else a.protect?toastr.error(a.msg,"Protected by Owner"):toastr.error(a.msg,"Error")},complete:function(){"undefined"!=typeof a[b]&&UploadLinks(a,++b),$(".preload1").hide(),setTimeout(function(){$("#btn-share").prop("disabled",!1)},5e3)},error:function(a){swal(a.status,"Oow.. error when receiving request, make sure input URL correctly","error")}})}function UploadLinks_2(a){results=[],$.ajax({url:app_url+"/ajax/share",type:"POST",cache:!0,data:{file_url:a},dataType:"json",beforeSend:function(){$("#shareFrm1").hide(),$("#btn-share").prop("disabled",!0),$(".preload1").show(),$("#sharetext").empty()},success:function(a){if(a.success){var b=app_url+"/"+a.share[0].file_url;results.push(b.link(b)),toastr.success(a.share[0].file_name,"Success"),$("#shareFrm1").show(400),$("#sharetext").html(results.join("<br/>"))}else a.protect?toastr.error(a.msg,"Protected by Owner"):toastr.error(a.msg,"Error")},complete:function(){$(".preload1").hide(),setTimeout(function(){$("#btn-share").prop("disabled",!1)},5e3)},error:function(a){console.log(a),swal("Failed","Oow.. error when receiving request, make sure input URL correctly","error")}})}function UploadPicker(a){var b=[],c=[],d=[];return 1>a.length?swal("Please choose a file to continue"):void($("#btn-share").prop("disabled",!0),$.each(a,function(a,e){var f=$(e),g=f.attr("g-id");f.find(".statFile").html(`<small class="badge-pill badge-secondary">uploading..</small>`),$.ajax({url:app_url+"/ajax/share-picker",type:"POST",cache:!0,data:{data_file:g},success:function(a){if(a.success){var e=a.share[0],g=app_url+"/"+e.file_url,h=htmlEntities(`<a href="${g}">${e.file_name}</a>`),i=htmlEntities(`[URL=${g}]${e.file_name}[/URL]`);b.push(g.link(g)),c.push(h),d.push(i),f.find(".nameFile").attr(`href`,"/"+e.file_url),f.find(".statFile").html(`<small class="badge-pill badge-success"><i class="fa fa-check"></i></small>`)}else f.find(".statFile").html(`<small class="badge-pill badge-danger">error</small>`)},complete:function(){$("#shareFrm2").show(400),$("#sharetext").html(b.join("<br/>")),$("#sharehtmlcode").html(c.join("<br/>")),$("#sharebbcode").html(d.join("<br/>")),setTimeout(function(){$("#btn-share").prop("disabled",!1)},5e3)},error:function(a){console.log(a.status)}})}))}const htmlEntities=a=>(a+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");